(function(E){function y(a,e){for(var b=a.length;0<=--b;)if(a[b]===e)return!0}function m(a){return r(a)?a:[a]}function q(a,e,b){e=r(e)?e:[e];for(var c=[],l=a.props,g={},j={values:c},d=e.length;0<=--d;)a=e[d],k.call(l,a)||(j.missing=g,g[a]=!0),c.unshift(l[a]);return b?b.apply({},c):j}function s(a,e,b){var c,l=a.listeners,g,j=[].concat(l),d=j.length;c=a.props;g=c[e];var f=k.call(c,e),h=b&&typeof b===t;c[e]=b;if(!f||g!==b||h&&!y(u,b)){for(h&&u.push(b);0<=--d;){c=j[d];b=c.keys;if(g=c.missing){if(k.call(g,
e)){delete g[e];a:{f=void 0;for(f in g)if(k.call(g,f)){g=!1;break a}g=!0}g&&(c.cb.apply({},q(a,b).values),c.calls--)}}else y(b,e)&&(c.cb.apply({},q(a,b).values),c.calls--);if(!c.calls)a:{b=l;for(c=b.length;0<=--c;)if(!b[c].calls){b.splice(c,1);break a}}}delete a.needs[e];h&&u.pop()}}function z(a){var e;return function(){e||(e=!0,a.apply(this,arguments))}}function A(a,e,b){b(z(function(b){s(a,e,b)}))}var n,B=Object.prototype,k=B.hasOwnProperty,t="object",p="undefined"!==typeof window?window:global,
C=k.call(p,"atom"),F=p.atom,D=Array.prototype.slice,r=Array.isArray||function(a){return"[object Array]"===B.toString.call(a)},u=[];n=p.atom=function(){function a(){d&&(d.pending=d.next=!d.next&&d.length?d.shift():d.next,d.args=D.call(arguments,0),d.pending&&(d.next=null,d.pending.apply({},[z(a)].concat(d.args))))}var e=D.call(arguments,0),b={props:{},needs:{},providers:{},listeners:[]},c=b.props,l=b.needs,g=b.providers,j=b.listeners,d=[],f={chain:function(){if(d)for(var h=0,v=arguments.length;h<v;h++)d.push(arguments[h]),
d.pending||a.apply({},d.args||[]);return f},destroy:function(){delete b.props;delete b.needs;delete b.providers;for(delete b.listeners;d.length;)d.pop();b=c=l=g=j=d=d.pending=d.next=d.args=null},each:function(h,v){for(var b=m(h),a=-1,d=b.length,c;++a<d;)c=b[a],v(c,f.get(c));return f},entangle:function(h,b){var a=r(b),c=!a&&typeof b===t,d,a=a?b:c?[]:[b],e=c?b:{};if(c)for(d in e)k.call(e,d)&&a.push(d);else for(c=a.length;0<=--c;)d=a[c],e[d]=d;f.each(a,function(b){var a=e[b];f.bind(b,function(b){h.set(a,
b)});h.bind(a,function(h){f.set(b,h)})});return f},get:function(h,a){var c=q(b,h,a);return a?c:"string"===typeof h?c.values[0]:c.values},has:function(b){b=m(b);for(var a=b.length;0<=--a;)if(!k.call(c,b[a]))return!1;return!0},keys:function(){var b=[],a;for(a in c)k.call(c,a)&&b.push(a);return b},mixin:function(b){for(var a in b)k.call(b,a)&&(f[a]=b[a]);return f},need:function(a,d){for(var e,w=m(a),x,j=w.length;0<=--j;)e=w[j],x=g[e],!k.call(c,e)&&x?(A(b,e,x),delete g[e]):l[e]=!0;if(d)f.once(w,d);return f},
next:function(b,a){j.unshift({keys:m(b),cb:a,calls:1});return f},off:function(b,a){var c=j.length,d;1===arguments.length&&(a=b,b=null);for(;0<=--c;){d=j[c];var e;if(e=d.cb===a)if(!(e=!b)){d=d.keys;e=b;var g=void 0,k=void 0;d===e?e=!0:(g=[].concat(m(d)).sort(),k=[].concat(m(e)).sort(),e=g+""===k+"")}e&&j.splice(c,1)}return f},on:function(b,a){j.unshift({keys:m(b),cb:a,calls:Infinity});return f},once:function(a,d){var e=m(a),c=q(b,e),g=c.values;(c=c.missing)?j.unshift({keys:e,cb:d,missing:c,calls:1}):
d.apply({},g);return f},provide:function(a,c){l[a]?A(b,a,c):g[a]||(g[a]=c);return f},set:function(a,c){if(typeof a===t)for(var d in a)k.call(a,d)&&s(b,d,a[d]);else s(b,a,c);return f}};f.bind=f.on;f.unbind=f.off;e.length&&f.set.apply(f,e);return f};n.VERSION="0.5.5";n.create=n;n.noConflict=function(){if(p.atom===n&&(p.atom=C?F:E,!C))try{delete p.atom}catch(a){}return n};"undefined"!==typeof module&&module.exports&&(module.exports=n)})();